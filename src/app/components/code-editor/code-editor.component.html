<!-- Editor de Código Kotlin -->
<div class="code-editor-container">
  <!-- Header del Editor -->
  <div class="editor-header">
    <div class="header-left">
      <h2 class="editor-title">
        Editor de Código Kotlin
      </h2>
      <span class="file-type">*.kt</span>
    </div>
    <div class="header-right">
      <span class="info-badge">
        {{ lineCount }} líneas
      </span>
      <span class="info-badge">
        {{ charCount }} caracteres
      </span>
    </div>
  </div>

  <!-- Barra de Herramientas -->
  <div class="editor-toolbar">
    <!-- Botones de Acción -->
    <div class="toolbar-section">
      <button 
        class="btn btn-primary"
        (click)="analyzeCode()"
        [disabled]="isAnalyzing || sourceCode.trim() === ''"
        title="Analizar código (Ctrl+Enter)">
        <span *ngIf="!isAnalyzing">Analizar Código</span>
        <span *ngIf="isAnalyzing">Analizando...</span>
      </button>

      <button 
        class="btn btn-secondary"
        (click)="clearCode()"
        [disabled]="isAnalyzing"
        title="Limpiar editor">
        Limpiar
      </button>

      <button 
        class="btn btn-secondary"
        (click)="loadDefaultExample()"
        [disabled]="isAnalyzing"
        title="Cargar ejemplo por defecto">
        Ejemplo
      </button>
    </div>

    <!-- Selector de Ejemplos -->
    <div class="toolbar-section">
      <label for="exampleSelect" class="toolbar-label">Ejemplos:</label>
      <select 
        id="exampleSelect"
        class="example-select"
        [(ngModel)]="selectedExample"
        (ngModelChange)="insertExample($event)"
        [disabled]="isAnalyzing">
        <option value="">Seleccionar ejemplo...</option>
        <option value="variables">Variables</option>
        <option value="functions">Funciones</option>
        <option value="classes">Clases</option>
        <option value="control">Estructuras de Control</option>
        <option value="operators">Operadores</option>
      </select>
    </div>
  </div>

  <!-- Área del Editor -->
  <div class="editor-wrapper">
    <!-- Números de Línea -->
    <div class="line-numbers" #lineNumbers>
      <div 
        class="line-number" 
        *ngFor="let line of sourceCode.split('\n'); let i = index">
        {{ i + 1 }}
      </div>
    </div>

    <!-- Textarea del Código -->
    <textarea
      #codeTextarea
      class="code-textarea"
      [(ngModel)]="sourceCode"
      (scroll)="syncScroll($event)"
      placeholder="Escribe tu código Kotlin aquí...
// Ejemplo:
fun main() {
    println(&quot;Hola Mundo&quot;)
}
"
      spellcheck="false"
      [disabled]="isAnalyzing"
      (keydown.control.enter)="analyzeCode()">
    </textarea>
  </div>

  <!-- Footer con Estado -->
  <div class="editor-footer">
    <div class="footer-left">
      <span class="status-indicator" [class.analyzing]="isAnalyzing">
        <span class="status-dot"></span>
        <span *ngIf="!isAnalyzing">Listo</span>
        <span *ngIf="isAnalyzing">Analizando...</span>
      </span>
    </div>
    <div class="footer-right">
      <span class="footer-info" *ngIf="lastAnalysisResult">
        Último análisis: 
        <strong>{{ lastAnalysisResult.tokens.length - 1 }} tokens</strong>,
        <strong 
          [class.error-text]="lastAnalysisResult.errors.length > 0"
          [class.success-text]="lastAnalysisResult.errors.length === 0">
          {{ lastAnalysisResult.errors.length }} errores
        </strong>
        ({{ lastAnalysisResult.analysisTime.toFixed(2) }} ms)
      </span>
    </div>
  </div>
</div>

<!-- Modal de Confirmación para Limpiar Código -->
<app-confirm-modal
  [isOpen]="showClearModal"
  title="¿Limpiar código?"
  message="¿Está seguro que desea limpiar todo el código del editor? Esta acción no se puede deshacer."
  confirmText="Aceptar"
  cancelText="Cancelar"
  type="warning"
  (confirmed)="confirmClear()"
  (cancelled)="cancelClear()">
</app-confirm-modal>
